TP2 B2-RESEAU


***I. Topologie réseau***


☀️ Sur node1.lan1.tp2

* afficher ses cartes réseau
* afficher sa table de routage
* prouvez qu'il peut joindre node2.lan2.tp2
* prouvez avec un traceroute que le paquet passe bien par router.tp2

```
[clone@node1 ~]$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: enp0s8: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:aa:b0:34 brd ff:ff:ff:ff:ff:ff
    inet 10.1.1.11/24 brd 10.1.1.255 scope global noprefixroute enp0s8
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:feaa:b034/64 scope link
       valid_lft forever preferred_lft forever
```

```
[clone@node1 ~]$ ip n s
10.1.1.1 dev enp0s8 lladdr 0a:00:27:00:00:09 REACHABLE
10.1.1.254 dev enp0s8 lladdr 08:00:27:15:97:ac STALE
```

```
[clone@node1 ~]$ ping 10.1.2.12
PING 10.1.2.12 (10.1.2.12) 56(84) bytes of data.
64 bytes from 10.1.2.12: icmp_seq=1 ttl=63 time=0.799 ms
64 bytes from 10.1.2.12: icmp_seq=2 ttl=63 time=0.868 ms
64 bytes from 10.1.2.12: icmp_seq=3 ttl=63 time=0.390 ms
^C
--- 10.1.2.12 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2049ms
rtt min/avg/max/mdev = 0.390/0.685/0.868/0.213 ms
```

```
[clone@node1 ~]$ traceroute 10.1.2.12
traceroute to 10.1.2.12 (10.1.2.12), 30 hops max, 60 byte packets
 1  10.1.1.254 (10.1.1.254)  1.787 ms  1.885 ms  1.815 ms
 2  10.1.2.12 (10.1.2.12)  1.782 ms !X  1.778 ms !X  3.762 ms !X
```

***II. Interlude accès internet***

☀️ Sur router.tp2

```
[clone@router ~]$ ping 1.1.1.1
PING 1.1.1.1 (1.1.1.1) 56(84) bytes of data.
64 bytes from 1.1.1.1: icmp_seq=1 ttl=55 time=10.6 ms
64 bytes from 1.1.1.1: icmp_seq=2 ttl=55 time=10.1 ms
64 bytes from 1.1.1.1: icmp_seq=3 ttl=55 time=10.4 ms
64 bytes from 1.1.1.1: icmp_seq=4 ttl=55 time=9.90 ms
^C
--- 1.1.1.1 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3005ms
rtt min/avg/max/mdev = 9.897/10.257/10.587/0.298 ms
```

```
[clone@router ~]$ ping ynov.com
PING ynov.com (104.26.10.233) 56(84) bytes of data.
64 bytes from 104.26.10.233 (104.26.10.233): icmp_seq=1 ttl=55 time=11.1 ms
64 bytes from 104.26.10.233 (104.26.10.233): icmp_seq=2 ttl=55 time=11.4 ms
64 bytes from 104.26.10.233 (104.26.10.233): icmp_seq=3 ttl=55 time=11.2 ms
64 bytes from 104.26.10.233 (104.26.10.233): icmp_seq=4 ttl=55 time=11.0 ms
64 bytes from 104.26.10.233 (104.26.10.233): icmp_seq=5 ttl=55 time=10.7 ms
64 bytes from 104.26.10.233 (104.26.10.233): icmp_seq=6 ttl=55 time=11.0 ms
^C
--- ynov.com ping statistics ---
6 packets transmitted, 6 received, 0% packet loss, time 5009ms
rtt min/avg/max/mdev = 10.673/11.065/11.397/0.224 ms
```

☀️ Accès internet LAN1 et LAN2

```
[clone@node2 ~]$ cat /etc/sysconfig/network
# Created by anaconda
GATEWAY=10.1.1.254
```

```
[clone@node2 ~]$ cat /etc/resolv.conf
# Generated by NetworkManager
search lan1.tp2
nameserver 1.1.1.1
```

```
[clone@node2 ~]$ ping 1.1.1.1
PING 1.1.1.1 (1.1.1.1) 56(84) bytes of data.
64 bytes from 1.1.1.1: icmp_seq=1 ttl=54 time=11.3 ms
64 bytes from 1.1.1.1: icmp_seq=2 ttl=54 time=11.2 ms
64 bytes from 1.1.1.1: icmp_seq=3 ttl=54 time=10.6 ms
64 bytes from 1.1.1.1: icmp_seq=4 ttl=54 time=10.4 ms
^X64 bytes from 1.1.1.1: icmp_seq=5 ttl=54 time=10.4 ms
^C
--- 1.1.1.1 ping statistics ---
5 packets transmitted, 5 received, 0% packet loss, time 4004ms
rtt min/avg/max/mdev = 10.360/10.771/11.315/0.406 ms
```

```
[clone@node2 ~]$ ping ynov.com
PING ynov.com (172.67.74.226) 56(84) bytes of data.
64 bytes from 172.67.74.226 (172.67.74.226): icmp_seq=1 ttl=54 time=11.4 ms
64 bytes from 172.67.74.226 (172.67.74.226): icmp_seq=2 ttl=54 time=11.4 ms
64 bytes from 172.67.74.226 (172.67.74.226): icmp_seq=3 ttl=54 time=11.7 ms
64 bytes from 172.67.74.226 (172.67.74.226): icmp_seq=4 ttl=54 time=10.9 ms
64 bytes from 172.67.74.226 (172.67.74.226): icmp_seq=5 ttl=54 time=11.6 ms
^C
--- ynov.com ping statistics ---
5 packets transmitted, 5 received, 0% packet loss, time 4007ms
rtt min/avg/max/mdev = 10.878/11.406/11.679/0.296 ms
```

***III. Services réseau***

☀️ Sur dhcp.lan1.tp2

```
[clone@dhcp ~]$ cat /etc/sysconfig/network-scripts/ifcfg-enp0s8
DEVICE=enp0s8

BOOTPROTO=static
ONBOOT=yes

IPADDR=10.1.1.253
```

`sudo dnf install dhcp-server -y`

```
[clone@dhcp ~]$ sudo cat /etc/dhcp/dhcpd.conf
[sudo] password for clone:
# create new
# specify domain name
option domain-name "Smaintos-DHCP-Server";

#specify DNS server's hostname or IP address
option domain-name-servers 1.1.1.1;

#default lease time
default-lease-time 600;

#max lease time
max-lease-time 7200;

# this DHCP server to be declared valid
authoritative;

#specify network address and subnetmask
subnet 10.1.1.0 netmask 255.255.255.0 {
        #specify range of lease IP address
        range dynamic-bootp 10.1.1.100 10.1.1.200;
        #specify broadcast address
        option broadcast-address 10.1.1.255;
        #specify gateway
        option routers 10.1.1.254;
}
```

```
[clone@dhcp ~]$ sudo systemctl status dhcpd
● dhcpd.service - DHCPv4 Server Daemon
   Loaded: loaded (/usr/lib/systemd/system/dhcpd.service; enabled; vendor preset: disabled)
   Active: active (running) since Wed 2023-10-25 15:50:46 CEST; 1min 24s ago
     Docs: man:dhcpd(8)
           man:dhcpd.conf(5)
 Main PID: 1974 (dhcpd)
   Status: "Dispatching packets..."
    Tasks: 1 (limit: 11148)
   Memory: 8.6M
   CGroup: /system.slice/dhcpd.service
           └─1974 /usr/sbin/dhcpd -f -cf /etc/dhcp/dhcpd.conf -user dhcpd -group dhcpd --no-pid

Oct 25 15:50:46 dhcp.lan1.tp2 dhcpd[1974]: Config file: /etc/dhcp/dhcpd.conf
Oct 25 15:50:46 dhcp.lan1.tp2 dhcpd[1974]: Database file: /var/lib/dhcpd/dhcpd.leases
Oct 25 15:50:46 dhcp.lan1.tp2 dhcpd[1974]: PID file: /var/run/dhcpd.pid
Oct 25 15:50:46 dhcp.lan1.tp2 dhcpd[1974]: Source compiled to use binary-leases
Oct 25 15:50:46 dhcp.lan1.tp2 dhcpd[1974]: Wrote 0 leases to leases file.
Oct 25 15:50:46 dhcp.lan1.tp2 dhcpd[1974]: Listening on LPF/enp0s8/08:00:27:a8:c6:6f/10.1.1.0/24
Oct 25 15:50:46 dhcp.lan1.tp2 systemd[1]: Started DHCPv4 Server Daemon.
Oct 25 15:50:46 dhcp.lan1.tp2 dhcpd[1974]: Sending on   LPF/enp0s8/08:00:27:a8:c6:6f/10.1.1.0/24
Oct 25 15:50:46 dhcp.lan1.tp2 dhcpd[1974]: Sending on   Socket/fallback/fallback-net
Oct 25 15:50:46 dhcp.lan1.tp2 dhcpd[1974]: Server starting service.
```

☀️ Sur node1.lan1.tp2


```
[clone@node1 ~]$ sudo cat /etc/sysconfig/network-scripts/ifcfg-enp0s8
[sudo] password for clone:
DEVICE=enp0s8

BOOTPROTO=dhcp
ONBOOT=yes
```

```
[clone@node1 ~]$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: enp0s8: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:aa:b0:34 brd ff:ff:ff:ff:ff:ff
    inet 10.1.1.100/24 brd 10.1.1.255 scope global dynamic noprefixroute enp0s8
       valid_lft 318sec preferred_lft 318sec
    inet6 fe80::a00:27ff:feaa:b034/64 scope link
       valid_lft forever preferred_lft forever
```

```
[clone@dhcp ~]$ ip n s
10.1.1.100 dev enp0s8 lladdr 08:00:27:aa:b0:34 STALE
10.1.1.254 dev enp0s8 lladdr 08:00:27:15:97:ac STALE
10.1.1.1 dev enp0s8 lladdr 0a:00:27:00:00:09 DELAY
```

```
[clone@node1 ~]$ ping 10.1.2.11
PING 10.1.2.11 (10.1.2.11) 56(84) bytes of data.
64 bytes from 10.1.2.11: icmp_seq=1 ttl=63 time=1.17 ms
64 bytes from 10.1.2.11: icmp_seq=2 ttl=63 time=0.455 ms
64 bytes from 10.1.2.11: icmp_seq=3 ttl=63 time=0.301 ms
64 bytes from 10.1.2.11: icmp_seq=4 ttl=63 time=0.536 ms
^C
--- 10.1.2.11 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3057ms
rtt min/avg/max/mdev = 0.301/0.616/1.173/0.332 ms
```

***2. Web web web***

☀️ Sur web.lan2.tp2


```
[clone@web ~]$ sudo dnf install nginx -y

Installing:
 nginx                              x86_64        1:1.14.1-9.module+el8.4.0+542+81547229         appstream        566 k
```

```
[clone@web ~]$ sudo cat /etc/nginx/conf.d/site_nul.conf
server {
        listen 80;
        listen [::]:80;

        root /var/www/site_nul;
        index index.html index.htm;

        server_name site_nul.tp2 www.site_nul.tp2;

        location / {
                try_files $uri $uri/ =404;
        }

}
```

```
[clone@web ~]$ sudo systemctl status nginx
● nginx.service - The nginx HTTP and reverse proxy server
   Loaded: loaded (/usr/lib/systemd/system/nginx.service; enabled; vendor preset: disabled)
   Active: active (running) since Thu 2023-10-26 14:02:06 CEST; 8min ago
  Process: 782 ExecStart=/usr/sbin/nginx (code=exited, status=0/SUCCESS)
  Process: 761 ExecStartPre=/usr/sbin/nginx -t (code=exited, status=0/SUCCESS)
  Process: 756 ExecStartPre=/usr/bin/rm -f /run/nginx.pid (code=exited, status=0/SUCCESS)
 Main PID: 783 (nginx)
    Tasks: 2 (limit: 11148)
   Memory: 12.5M
   CGroup: /system.slice/nginx.service
           ├─783 nginx: master process /usr/sbin/nginx
           └─784 nginx: worker process
            [...]
```

```
[clone@web ~]$ sudo firewall-cmd --list-all
public (active)
  target: default
  icmp-block-inversion: no
  interfaces: enp0s8
  sources:
  services: cockpit dhcpv6-client ssh
  ports: 80/tcp
  protocols:
  forward: no
  masquerade: no
  forward-ports:
  source-ports:
  icmp-blocks:
  rich rules:
```
```
[clone@web ~]$ ss -ltpu | grep http
tcp   LISTEN 0      128          0.0.0.0:http      0.0.0.0:*
tcp   LISTEN 0      128             [::]:http         [::]:*
```

```
[clone@node1 ~]$ sudo cat /etc/hosts
[sudo] password for clone:
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
10.1.2.12 site_nul.tp2
```



```
[clone@node1 ~]$ curl site_nul.tp2
<!DOCTYPE html>
<html>
<head>
    <title>Le site nul</title>
</head>
<body>

<h1>Bienvenue sur le site nul.</h1>
<p>je rappel que personne ne pense à cocher la case afficher les extensions voila</p>

</body>
</html>
```




                        
                        
```
PS C:\Users\onacr> curl site_nul.tp2


StatusCode        : 200
StatusDescription : OK
Content           : <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Le site nul</title>
                    </head>
                    <body>

                    <h1>Bienvenue sur le site nul.</h1>
                    <p>je rappel que personne ne pense Ã  cocher la case afficher les extensions voila</p>
                    ...
RawContent        : HTTP/1.1 200 OK
                    Connection: keep-alive
                    Accept-Ranges: bytes
                    Content-Length: 218
                    Content-Type: text/html
                    Date: Thu, 26 Oct 2023 12:19:10 GMT
                    ETag: "653a5881-da"
                    Last-Modified: Thu, 26 Oct 2023 1...
Forms             : {}
Headers           : {[Connection, keep-alive], [Accept-Ranges, bytes], [Content-Length, 218], [Content-Type, text/html]...}
Images            : {}
InputFields       : {}
Links             : {}
ParsedHtml        : System.__ComObject
RawContentLength  : 218
```